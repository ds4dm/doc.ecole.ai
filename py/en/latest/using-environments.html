

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Using Environments &mdash; Ecole 0.6.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Use Observation Functions" href="howto/observation-functions.html" />
    <link rel="prev" title="Installation" href="installation.html" />
<script>
	window.goatcounter = { path: function(p) { return location.host + p } }
</script>
<script data-goatcounter="https://ecoleai.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/ecole-logo-bare.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using Environments</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-structure">General structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#environment-parameters">Environment parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#resetting-environments">Resetting environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#transitioning">Transitioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#seeding-environments">Seeding environments</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">How to</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="howto/observation-functions.html">Use Observation Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="howto/reward-functions.html">Use Reward Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="howto/create-functions.html">Create New Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="howto/create-environments.html">Create New Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="howto/instances.html">Generate Problem Instances</a></li>
</ul>
<p class="caption"><span class="caption-text">Practical Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/ds4dm/ecole/tree/master/examples/configuring-bandits.ipynb">Configuring the Solver with Bandits</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/ds4dm/ecole/tree/master/examples/branching-imitation.ipynb">Branching with Imitation Learning</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="reference/environments.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/observations.html">Observations</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/rewards.html">Rewards</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/information.html">Informations</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/scip-interface.html">SCIP Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/instances.html">Instance Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/utilities.html">Utilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Discussion</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="discussion/gym-differences.html">Differences with OpenAi Gym</a></li>
<li class="toctree-l1"><a class="reference internal" href="discussion/seeding.html">Seeding</a></li>
<li class="toctree-l1"><a class="reference internal" href="discussion/theory.html">Ecole Theoretical Model</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Zone</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers/example-observation.html">Example Contribute Observation Function</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Ecole</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Using Environments</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/ds4dm/ecole/blob/master/docs/using-environments.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-environments">
<h1>Using Environments<a class="headerlink" href="#using-environments" title="Permalink to this headline">¶</a></h1>
<p>The goal of Ecole is to provide Markov decision process abstractions of common sequential decision making tasks that
appear when solving combinatorial optimization problems using a solver.
These control tasks are represented by stateful classes called environments.</p>
<p>In this formulation, each solving of an instance is an episode.
The environment class must first be instantiated, and then a specific instance must be loaded by a call to
<a class="reference internal" href="reference/environments.html#ecole.environment.Environment.reset" title="ecole.environment.Environment.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reset()</span></code></a>, which will bring the process to its initial state.
Afterwards, successive calls to <a class="reference internal" href="reference/environments.html#ecole.environment.Environment.step" title="ecole.environment.Environment.step"><code class="xref py py-meth docutils literal notranslate"><span class="pre">step()</span></code></a> will take an action from the
user and transition to the next state.
Finally, when the episode is finished, that is when the instance has been fully solved, a new solving episode can be
started with another call to <a class="reference internal" href="reference/environments.html#ecole.environment.Environment.reset" title="ecole.environment.Environment.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reset()</span></code></a>.</p>
<p>For instance, using the <a class="reference internal" href="reference/environments.html#ecole.environment.Branching" title="ecole.environment.Branching"><code class="xref py py-class docutils literal notranslate"><span class="pre">Branching</span></code></a> environment for branch-and-bound variable selection,
solving a specific instance once by always selecting the first fractional variable would look as follows.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ecole</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">ecole</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">Branching</span><span class="p">()</span>
<span class="n">env</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">observation</span><span class="p">,</span> <span class="n">action_set</span><span class="p">,</span> <span class="n">reward_offset</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="s2">&quot;path/to/instance&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
        <span class="n">observation</span><span class="p">,</span> <span class="n">action_set</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action_set</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>Let us analyze this example in more detail.</p>
<div class="section" id="general-structure">
<h2>General structure<a class="headerlink" href="#general-structure" title="Permalink to this headline">¶</a></h2>
<p>The example is driven by two loops.
The inner <code class="docutils literal notranslate"><span class="pre">while</span></code> loop, the so-called <em>control loop</em>, transitions from an initial state until a
terminal state is reached, which is signaled with the boolean flag <code class="docutils literal notranslate"><span class="pre">done</span> <span class="pre">==</span> <span class="pre">True</span></code>.
In Ecole, the termination of the environment coincides with the termination of the underlying combinatorial
optimization algorithm.
A full execution of this loop is known as an <em>episode</em>.
The control loop matches a Markov decision process formulation, as used in control theory, dynamic programming and
reinforcement learning.</p>
<div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="_images/mdp.png"><img alt="Markov Decision Process interaction loop." src="_images/mdp.png" style="width: 60%;" /></a>
<p class="caption"><span class="caption-text">The control loop of a Markov decision process.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>More exactly, the control loop in Ecole is that of a <a class="reference external" href="https://en.wikipedia.org/wiki/Partially_observable_Markov_decision_process">partially-observable Markov decision process</a> (PO-MDP), since
only a subset of the MDP state is extracted from the environment in the form of an <em>observation</em>. We omit
this detail here for simplicity.</p>
</div>
<p>The outer <code class="docutils literal notranslate"><span class="pre">for</span></code> loop in the example simply repeats the control loop several times, and is in
charge of generating the initial state of each episode.
In order to obtain a sufficient statistical signal for learning the control policy, numerous episodes are usually
required for learning.
Also, although not showcased here, there is usually little practical interest in using the same combinatorial problem
instance for generating each episode.
Indeed, it is usually desirable to learn policies that will generalize to new, unseen instances, which is very unlikely
if the learning policy is tailored to solve a single specific instance.
Ideally, one would like to sample training episodes from a family of similar instances, in order to solve new, similar
instances in the future.
For more details, see the <a class="reference internal" href="discussion/theory.html#theory"><span class="std std-ref">Ecole theortical model</span></a> in the discussion.</p>
</div>
<div class="section" id="environment-parameters">
<span id="id1"></span><h2>Environment parameters<a class="headerlink" href="#environment-parameters" title="Permalink to this headline">¶</a></h2>
<p>Each environment can be given a set of parameters at construction, in order to further customize the task being
solved.
For instance, the <a class="reference internal" href="reference/environments.html#ecole.environment.Branching" title="ecole.environment.Branching"><code class="xref py py-class docutils literal notranslate"><span class="pre">Branching</span></code></a> environment takes a <code class="docutils literal notranslate"><span class="pre">pseudo_candidates</span></code>
boolean parameter, to decide whether branching candidates should include all non fixed integral variables, or only the
fractional ones.
Environments can be instantiated with no constructor arguments, as in the previous example, in which case a set of
default parameters will be used.</p>
<p>Every environment can optionally take a dictionary of
<a class="reference external" href="https://scip.zib.de/doc/html/PARAMETERS.php">SCIP parameters</a> that will be used to
initialize the solver at every episode.
For instance, to customize the clique inequalities generated, one could set:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">ecole</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">Branching</span><span class="p">(</span>
    <span class="n">scip_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;separating/clique/freq&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;separating/clique/maxsepacuts&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Depending on the nature of the environment, some user-given parameters can be overriden
or ignored (<em>e.g.</em>, branching parameters in the <a class="reference internal" href="reference/environments.html#ecole.environment.Branching" title="ecole.environment.Branching"><code class="xref py py-class docutils literal notranslate"><span class="pre">Branching</span></code></a>
environment).
It is the responsibility of the user to understand the environment they are using.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For out-out-the-box strategies on presolving, heuristics, and cutting planes, consider
using the dedicated
<a class="reference external" href="https://scip.zib.de/doc/html/group__ParameterMethods.php">SCIP methods</a>
(<code class="docutils literal notranslate"><span class="pre">SCIPsetHeuristics</span></code> <em>etc.</em>).</p>
</div>
<p><a class="reference internal" href="howto/observation-functions.html#use-observation-functions"><span class="std std-ref">Observation functions</span></a> and
<a class="reference internal" href="howto/observation-functions.html#use-observation-functions"><span class="std std-ref">reward functions</span></a> are more advanced environment
parameters, which we will discuss later on.</p>
</div>
<div class="section" id="resetting-environments">
<span id="id2"></span><h2>Resetting environments<a class="headerlink" href="#resetting-environments" title="Permalink to this headline">¶</a></h2>
<p>Each episode in the inner <code class="docutils literal notranslate"><span class="pre">while</span></code> starts with a call to
<a class="reference internal" href="reference/environments.html#ecole.environment.Environment.reset" title="ecole.environment.Environment.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reset()</span></code></a> in order to bring the environment into a new
initial state.
The method is parameterized with a problem instance: the combinatorial optimization problem that will be loaded and
solved by the <a class="reference external" href="https://scip.zib.de/">SCIP</a> solver during the episode.
In the most simple case this is the path to a problem file.
For problems instances that are generated programatically
(for instance using <a class="reference external" href="https://github.com/SCIP-Interfaces/PySCIPOpt">PyScipOpt</a> or using
<a class="reference internal" href="howto/instances.html#generate-instances"><span class="std std-ref">instance generators</span></a>) a <a class="reference internal" href="reference/scip-interface.html#ecole.scip.Model" title="ecole.scip.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">ecole.scip.Model</span></code></a> is also accepted.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">observation</span></code> consists of information about the state of the solver that should be used to select the next
action to perform (for example, using a machine learning algorithm.)</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">action_set</span></code>, when not <code class="docutils literal notranslate"><span class="pre">None</span></code>, describes the set of candidate actions which are valid for the next transition.
This is necessary for environments where the action set varies from state to state.
For instance, in the <a class="reference internal" href="reference/environments.html#ecole.environment.Branching" title="ecole.environment.Branching"><code class="xref py py-class docutils literal notranslate"><span class="pre">Branching</span></code></a> environment the set of candidate variables
for branching depends on the value of the current LP solution, which changes at every iteration of the algorithm.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">reward_offset</span></code> is an offset to the reward function that accounts for any computation happening in
<a class="reference internal" href="reference/environments.html#ecole.environment.Environment.reset" title="ecole.environment.Environment.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reset()</span></code></a> when generating the initial state.
For example, if clock time is selected as a reward function in a <a class="reference internal" href="reference/environments.html#ecole.environment.Branching" title="ecole.environment.Branching"><code class="xref py py-class docutils literal notranslate"><span class="pre">Branching</span></code></a> environment,
this would account for time spent in the preprocessing phase before any branching is performed.
This offset is thus important for benchmarking, but has no effect
on the control problem, and can be ignored when training a machine learning agent.</p></li>
<li><p>The boolean flag <code class="docutils literal notranslate"><span class="pre">done</span></code> indicates whether the initial state is also a terminal state.
This can happen in some environments, such as <a class="reference internal" href="reference/environments.html#ecole.environment.Branching" title="ecole.environment.Branching"><code class="xref py py-class docutils literal notranslate"><span class="pre">Branching</span></code></a>, where the problem instance
could be solved though presolving only (never actually getting to branching).</p></li>
</ul>
<p>See the reference section for the exact documentation of
<a class="reference internal" href="reference/environments.html#ecole.environment.Environment.reset" title="ecole.environment.Environment.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reset()</span></code></a>.</p>
</div>
<div class="section" id="transitioning">
<h2>Transitioning<a class="headerlink" href="#transitioning" title="Permalink to this headline">¶</a></h2>
<p>The inner <code class="docutils literal notranslate"><span class="pre">while</span></code> loop transitions the environment from one state to the next by giving
an action to <a class="reference internal" href="reference/environments.html#ecole.environment.Environment.step" title="ecole.environment.Environment.step"><code class="xref py py-meth docutils literal notranslate"><span class="pre">step()</span></code></a>.
The nature of <code class="docutils literal notranslate"><span class="pre">observation</span></code>, <code class="docutils literal notranslate"><span class="pre">action_set</span></code>, and <code class="docutils literal notranslate"><span class="pre">done</span></code> is the same as in the previous
section <a class="reference internal" href="#resetting-environments"><span class="std std-ref">Resetting environments</span></a>.
The <code class="docutils literal notranslate"><span class="pre">reward</span></code> and <code class="docutils literal notranslate"><span class="pre">info</span></code> variables provide additional information about
the current transition.</p>
<p>See the reference section for the exact documentation of
<a class="reference internal" href="reference/environments.html#ecole.environment.Environment.step" title="ecole.environment.Environment.step"><code class="xref py py-meth docutils literal notranslate"><span class="pre">step()</span></code></a>.</p>
</div>
<div class="section" id="seeding-environments">
<h2>Seeding environments<a class="headerlink" href="#seeding-environments" title="Permalink to this headline">¶</a></h2>
<p>Environments can be seeded by using the
<a class="reference internal" href="reference/environments.html#ecole.environment.Environment.seed" title="ecole.environment.Environment.seed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">seed()</span></code></a> method.
The seed is used by the environment (and in particular the solver) for all the
subsequent episode trajectories.
The solver is given a new seed at the beginning of every new trajectory (call to
<a class="reference internal" href="reference/environments.html#ecole.environment.Environment.reset" title="ecole.environment.Environment.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reset()</span></code></a>), in a way that preserves
determinism, without re-using the same seed repeatedly.</p>
<p>See the reference section for the exact documentation of
<a class="reference internal" href="reference/environments.html#ecole.environment.Environment.seed" title="ecole.environment.Environment.seed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">seed()</span></code></a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="howto/observation-functions.html" class="btn btn-neutral float-right" title="Use Observation Functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Antoine Prouvost, Maxime Gasse, Didier Chetelat, Justin Dumouchelle.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>